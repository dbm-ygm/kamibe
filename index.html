<!DOCTYPE html>  
<html>  
<head>  
  <title>日記アプリ</title>  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>  
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>  
</head>  
<body>  
  <h1>日記アプリ</h1>  
  
  <div id="user-signed-out">  
    <button id="login-btn">Googleでログイン</button>  
  </div>  
  
  <div id="user-signed-in" style="display:none;">  
    <p id="user-info"></p>  
    <button id="logout-btn">ログアウト</button>  
  
    <h2>日記を書く</h2>  
    <input type="text" id="title" placeholder="タイトル" /><br/>  
    <textarea id="content" placeholder="本文"></textarea><br/>  
    <button id="save-btn">保存</button>  
  </div>  
  
  <script>  
    // Firebase初期化  
    const firebaseConfig = {  
      apiKey: "YOUR_API_KEY",  
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",  
      projectId: "YOUR_PROJECT_ID",  
      // 他の設定も必要に応じて  
    };  
    firebase.initializeApp(firebaseConfig);  
  
    const auth = firebase.auth();  
    const db = firebase.firestore();  
  
    const loginBtn = document.getElementById('login-btn');  
    const logoutBtn = document.getElementById('logout-btn');  
    const userSignedOutDiv = document.getElementById('user-signed-out');  
    const userSignedInDiv = document.getElementById('user-signed-in');  
    const userInfo = document.getElementById('user-info');  
    const saveBtn = document.getElementById('save-btn');  
  
    loginBtn.onclick = () => {  
      const provider = new firebase.auth.GoogleAuthProvider();  
      auth.signInWithPopup(provider).catch(console.error);  
    };  
  
    logoutBtn.onclick = () => {  
      auth.signOut();  
    };  
  
    auth.onAuthStateChanged(user => {  
      if (user) {  
        userSignedOutDiv.style.display = 'none';  
        userSignedInDiv.style.display = 'block';  
        userInfo.textContent = `ログイン中: ${user.displayName} (${user.email})`;  
      } else {  
        userSignedOutDiv.style.display = 'block';  
        userSignedInDiv.style.display = 'none';  
      }  
    });  
  
    saveBtn.onclick = async () => {  
      const user = auth.currentUser;  
      if (!user) {  
        alert('ログインしてください');  
        return;  
      }  
  
      const title = document.getElementById('title').value;  
      const content = document.getElementById('content').value;  
  
      if (!title || !content) {  
        alert('タイトルと本文を入力してください');  
        return;  
      }  
  
      const entry = {  
        date: new Date().toISOString(),  
        title,  
        content,  
      };  
  
      try {  
        await db.collection('users')  
          .doc(user.uid)  
          .collection('diaryEntries')  
          .add(entry);  
        alert('日記を保存しました');  
        document.getElementById('title').value = '';  
        document.getElementById('content').value = '';  
      } catch (e) {  
        console.error(e);  
        alert('保存に失敗しました');  
      }  
    };  
  </script>  
</body>  
</html>  
